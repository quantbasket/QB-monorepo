<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>

  <script id="messenger-widget-b" src="https://cdn.botpenguin.com/website-bot.js" defer>688b6633831c3303762e6c07,688b6584e043a9aed316179b</script>

  <script>
    // The CSS selector for the entire bot container.
    const BOT_SELECTOR = '#botpenguin-root, .botpenguin-widget, #messenger-widget-b, [id*="botpenguin"], [class*="botpenguin"]';

    // This function adds a style tag to hide the bot on specific pages.
    function updateBotVisibility() {
      // --- IMPORTANT ---
      // Add the specific paths for dashboard and authenticated pages here.
      const blockedPaths = [
        '/dashboard', 
        '/app', 
        '/account',
        '/login',
        '/signup',
        '/settings',
        '/profile'
      ];

      let currentPath = window.location.pathname;
      // This handles cases like '/dashboard/' matching '/dashboard'
      if (currentPath.length > 1 && currentPath.endsWith('/')) {
        currentPath = currentPath.slice(0, -1);
      }

      let styleTag = document.getElementById('botpenguin-visibility-style');
      if (!styleTag) {
        styleTag = document.createElement('style');
        styleTag.id = 'botpenguin-visibility-style';
        document.head.appendChild(styleTag);
      }

      // Check if current path starts with any blocked path (for nested routes)
      const shouldHideBot = blockedPaths.some(path => 
        currentPath === path || currentPath.startsWith(path + '/')
      );

      // If the current page is on our blocklist or starts with blocked path, hide the bot.
      // Otherwise, make sure it's visible.
      if (shouldHideBot) {
        styleTag.innerHTML = `${BOT_SELECTOR} { display: none !important; }`; // HIDE
        console.log('ðŸ¤– BotPenguin hidden on protected page:', currentPath);
      } else {
        styleTag.innerHTML = ''; // SHOW (remove hiding styles)
        console.log('ðŸ¤– BotPenguin visible on public page:', currentPath);
      }
    }

    // Wait for bot to load before setting up visibility controls
    function initializeBotVisibility() {
      // This part listens for URL changes in your SPA.
      (function() {
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;
        
        history.pushState = function(...args) {
          originalPushState.apply(this, args);
          setTimeout(updateBotVisibility, 300);
        };
        
        history.replaceState = function(...args) {
          originalReplaceState.apply(this, args);
          setTimeout(updateBotVisibility, 300);
        };
        
        window.addEventListener('popstate', updateBotVisibility);
        window.addEventListener('hashchange', updateBotVisibility);
      })();
      
      // Run initial check
      setTimeout(updateBotVisibility, 100);
      
      // Periodic check to ensure bot visibility is correct
      setInterval(updateBotVisibility, 2000);
    }

    // Initialize after DOM is ready and bot has time to load
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(initializeBotVisibility, 1500); // Wait for bot to load
    });
    
    window.addEventListener('load', function() {
      setTimeout(initializeBotVisibility, 1000); // Additional check after full load
    });
  </script>
</body>